{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="recipe-detail-container">

    <!-- ğŸ§¾ TITLE -->
    <h1 class="recipe-title">{{ recipe.title }}</h1>

    <!-- ğŸ–¼ï¸ IMAGE + LIKE -->
    {% if recipe.image %}
    <div class="recipe-image-wrapper">

        <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">

        <!-- â¤ï¸ LIKE OVER IMAGE -->
        <form method="POST" action="{% url 'like_recipe' recipe.id %}" class="like-overlay">
            {% csrf_token %}
            <button type="submit" class="like-circle">
                â¤ï¸ <span>{{ recipe.total_likes }}</span>
            </button>
        </form>

    </div>
    {% endif %}

    <!-- ğŸ“¦ INGREDIENTS + INSTRUCTIONS -->
    <div class="recipe-sections">

        <!-- ğŸ§º INGREDIENTS -->
        <div class="recipe-box">
            <h3>ğŸ§º IngrÃ©dients</h3>
            <ul>
                {% for ing in recipe.ingredients.splitlines %}
                    {% if ing %}
                        <li>{{ ing }}</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>

        <!-- ğŸ‘¨â€ğŸ³ INSTRUCTIONS -->
        <div class="recipe-box">
            <h3>ğŸ‘¨â€ğŸ³ Instructions</h3>
            <ol>
                {% for step in instructions_list %}
                    {% if step %}
                        <li>{{ step }}</li>
                    {% endif %}
                {% endfor %}
            </ol>
        </div>

    </div>

    <!-- ğŸ’¬ COMMENTS -->
    <div class="comments-section">
        <h3>ğŸ’¬ Commentaires ({{ recipe.comments.count }})</h3>

        {% for comment in recipe.comments.all %}
            <div class="comment">
                <strong>{{ comment.user.username }}</strong>
                <p>{{ comment.content }}</p>
                <small>{{ comment.created_at|date:"d M Y H:i" }}</small>
            </div>
        {% empty %}
            <p>Aucun commentaire</p>
        {% endfor %}

        {% if user.is_authenticated %}
            <form method="POST" action="{% url 'add_comment' recipe.id %}" class="comment-form">
                {% csrf_token %}
                <textarea name="content" placeholder="Ã‰crire un commentaire..." required></textarea>
                <button type="submit">Envoyer</button>
            </form>
        {% else %}
            <p>ğŸ”’ Connectez-vous pour commenter</p>
        {% endif %}
    </div>

</div>
{% endblock %}
